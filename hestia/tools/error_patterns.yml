error_patterns:
  jinja_whitespace_control:
    category: "jinja"
    severity: "medium"
    symptoms: 
      - "empty_macro_output"
      - "unwanted_whitespace" 
      - "quoted_empty_strings"
      - "boolean_comparison_failure"
    detection_method: "template_developer_tools"
    regex_patterns:
      macro_opening: "{% macro.*[^-]%}"
      macro_closing: "{% endmacro %}"
    fix_patterns:
      macro_opening: "s/{% macro \\([^}]*\\) %}/{% macro \\1 -%}/g"
      macro_closing: "s/{% endmacro %}/{%- endmacro %}/g"
    examples:
      incorrect: |
        {% macro preference_select(sources) %}
          {% set result = 'off' %}
          {{ result }}
        {% endmacro %}
      correct: |
        {% macro preference_select(sources) -%}
          {%- set result = 'off' -%}
          {{- result -}}
        {%- endmacro %}
    validation_method: "template_developer_tools_clean_output"
    tooling:
      detector: "hestia/tools/template_patcher/fix_jinja_whitespace.sh --dry-run"
      fixer: "hestia/tools/template_patcher/fix_jinja_whitespace.sh"
      make_target: "make template-fix"
    references:
      - "ADR-0020"
      - "custom_templates/template.library.jinja"