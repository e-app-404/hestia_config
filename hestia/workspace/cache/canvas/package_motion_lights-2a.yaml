
# Package: Motion Lighting — Sanctum, Kitchen, Hallways
# Strategy: ADR-0021 β-sensors; eta-tier group targets; presence asymmetric; validation-first applied
# One-liner decisions:
# - Cooking mode helper: input_boolean.kitchen_cooking_mode (created)
# - Wardrobe package: excluded (only on explicit request)
# - Bypass doctrine: input_booleans per area + HACS var mirror (var.motion_bypass_*)
# - Propagation: upstairs listens to hallway_downstairs_motion_recent_beta (20s window handled in sensor)
#
# How to include:
# homeassistant:
#   packages: !include_dir_named packages
#
# Save as: packages/motion_lighting/motion_lighting_package.yaml

input_boolean:
  kitchen_cooking_mode:
    name: Kitchen Cooking Mode
    icon: mdi:pot-mix
  motion_bypass_bedroom_on:
    name: Motion Bypass Bedroom — Turn ON
    icon: mdi:motion-pause
  motion_bypass_bedroom_off:
    name: Motion Bypass Bedroom — Turn OFF
    icon: mdi:motion
  motion_bypass_bedroom_stop:
    name: Motion Bypass Bedroom — STOP
    icon: mdi:stop-circle-outline
  motion_bypass_desk_on:
    name: Motion Bypass Desk — Turn ON
    icon: mdi:motion-pause
  motion_bypass_desk_off:
    name: Motion Bypass Desk — Turn OFF
    icon: mdi:motion
  motion_bypass_desk_stop:
    name: Motion Bypass Desk — STOP
    icon: mdi:stop-circle-outline
  motion_bypass_ensuite_on:
    name: Motion Bypass Ensuite — Turn ON
    icon: mdi:motion-pause
  motion_bypass_ensuite_off:
    name: Motion Bypass Ensuite — Turn OFF
    icon: mdi:motion
  motion_bypass_ensuite_stop:
    name: Motion Bypass Ensuite — STOP
    icon: mdi:stop-circle-outline
  motion_bypass_kitchen_on:
    name: Motion Bypass Kitchen — Turn ON
    icon: mdi:motion-pause
  motion_bypass_kitchen_off:
    name: Motion Bypass Kitchen — Turn OFF
    icon: mdi:motion
  motion_bypass_kitchen_stop:
    name: Motion Bypass Kitchen — STOP
    icon: mdi:stop-circle-outline
  motion_bypass_hallway_downstairs_on:
    name: Motion Bypass Hallway Downstairs — Turn ON
    icon: mdi:motion-pause
  motion_bypass_hallway_downstairs_off:
    name: Motion Bypass Hallway Downstairs — Turn OFF
    icon: mdi:motion
  motion_bypass_hallway_downstairs_stop:
    name: Motion Bypass Hallway Downstairs — STOP
    icon: mdi:stop-circle-outline
  motion_bypass_hallway_upstairs_on:
    name: Motion Bypass Hallway Upstairs — Turn ON
    icon: mdi:motion-pause
  motion_bypass_hallway_upstairs_off:
    name: Motion Bypass Hallway Upstairs — Turn OFF
    icon: mdi:motion
  motion_bypass_hallway_upstairs_stop:
    name: Motion Bypass Hallway Upstairs — STOP
    icon: mdi:stop-circle-outline

var:
  motion_bypass_bedroom:
    friendly_name: Motion Bypass Bedroom
    initial_value: 'false'
  motion_timeout_bedroom:
    friendly_name: Motion Timeout Bedroom (minutes)
    initial_value: '5'
  motion_last_triggered_bedroom:
    friendly_name: Motion Last Triggered Bedroom
    initial_value: ''
  motion_bypass_desk:
    friendly_name: Motion Bypass Desk
    initial_value: 'false'
  motion_timeout_desk:
    friendly_name: Motion Timeout Desk (minutes)
    initial_value: '8'
  motion_last_triggered_desk:
    friendly_name: Motion Last Triggered Desk
    initial_value: ''
  motion_bypass_ensuite:
    friendly_name: Motion Bypass Ensuite
    initial_value: 'false'
  motion_timeout_ensuite:
    friendly_name: Motion Timeout Ensuite (minutes)
    initial_value: '10'
  motion_last_triggered_ensuite:
    friendly_name: Motion Last Triggered Ensuite
    initial_value: ''
  motion_bypass_kitchen:
    friendly_name: Motion Bypass Kitchen
    initial_value: 'false'
  motion_timeout_kitchen:
    friendly_name: Motion Timeout Kitchen (minutes)
    initial_value: '5'
  motion_last_triggered_kitchen:
    friendly_name: Motion Last Triggered Kitchen
    initial_value: ''
  motion_bypass_hallway_downstairs:
    friendly_name: Motion Bypass Hallway Downstairs
    initial_value: 'false'
  motion_timeout_hallway_downstairs:
    friendly_name: Motion Timeout Hallway Downstairs (minutes)
    initial_value: '3'
  motion_last_triggered_hallway_downstairs:
    friendly_name: Motion Last Triggered Hallway Downstairs
    initial_value: ''
  motion_bypass_hallway_upstairs:
    friendly_name: Motion Bypass Hallway Upstairs
    initial_value: 'false'
  motion_timeout_hallway_upstairs:
    friendly_name: Motion Timeout Hallway Upstairs (minutes)
    initial_value: '3'
  motion_last_triggered_hallway_upstairs:
    friendly_name: Motion Last Triggered Hallway Upstairs
    initial_value: ''

automation:
- alias: Motion Lights — Bedroom
  description: ADR-0021 β-sensors; eta-tier group targets
  id: motion_lights_bedroom
  initial_state: "on"
  max_exceeded: silent
  mode: restart
  use_blueprint:
    path: library/blueprints/sensor-light.yaml
    input:
      ambient_light_options: below_value
      ambient_light_sensor: sensor.bedroom_illuminance_beta
      ambient_light_value: 10
      include_ambient: ambient_enabled
      include_bypass:
        - bypass_enabled_turn_on
        - bypass_enabled_turn_off
        - bypass_auto_off
      bypass_auto_off_delay: 10
      bypass_time_delay: 0
      motion_bypass_lights_off: input_boolean.motion_bypass_bedroom_off
      motion_bypass_lights_on: input_boolean.motion_bypass_bedroom_on
      motion_bypass_lights_stop: input_boolean.motion_bypass_bedroom_stop
      light_switch:
        entity_id:
          - light.group_main_bedroom_lights
      motion_trigger:
        - binary_sensor.bedroom_motion_beta
        - binary_sensor.bedroom_occupancy_beta
      time_delay: 5
- alias: Motion Lights — Desk
  description: ADR-0021 β-sensors; eta-tier group targets
  id: motion_lights_desk
  initial_state: "on"
  max_exceeded: silent
  mode: restart
  use_blueprint:
    path: library/blueprints/sensor-light.yaml
    input:
      include_ambient: ambient_disabled
      include_bypass:
        - bypass_enabled_turn_on
        - bypass_enabled_turn_off
        - bypass_auto_off
      bypass_auto_off_delay: 10
      bypass_time_delay: 0
      motion_bypass_lights_off: input_boolean.motion_bypass_desk_off
      motion_bypass_lights_on: input_boolean.motion_bypass_desk_on
      motion_bypass_lights_stop: input_boolean.motion_bypass_desk_stop
      light_switch:
        entity_id:
          - light.group_desk_lights
      motion_trigger:
        - binary_sensor.desk_occupancy_beta
      time_delay: 8
- alias: Motion Lights — Ensuite
  description: ADR-0021 β-sensors; eta-tier group targets
  id: motion_lights_ensuite
  initial_state: "on"
  max_exceeded: silent
  mode: restart
  use_blueprint:
    path: library/blueprints/sensor-light.yaml
    input:
      include_ambient: ambient_disabled
      include_bypass:
        - bypass_enabled_turn_on
        - bypass_enabled_turn_off
        - bypass_auto_off
      bypass_auto_off_delay: 10
      bypass_time_delay: 0
      motion_bypass_lights_off: input_boolean.motion_bypass_ensuite_off
      motion_bypass_lights_on: input_boolean.motion_bypass_ensuite_on
      motion_bypass_lights_stop: input_boolean.motion_bypass_ensuite_stop
      light_switch:
        entity_id:
          - light.group_ensuite_lights
      motion_trigger:
        - binary_sensor.ensuite_motion_beta
        - binary_sensor.ensuite_occupancy_beta
      time_delay: 10
- alias: Motion Lights — Kitchen
  description: ADR-0021 β-sensors; eta-tier group targets; add-on uses kitchen_cooking_mode
  id: motion_lights_kitchen
  initial_state: "on"
  max_exceeded: silent
  mode: restart
  use_blueprint:
    path: library/blueprints/sensor-light.yaml
    input:
      include_ambient: ambient_disabled
      include_bypass:
        - bypass_enabled_turn_on
        - bypass_enabled_turn_off
        - bypass_auto_off
      bypass_auto_off_delay: 10
      bypass_time_delay: 0
      motion_bypass_lights_off: input_boolean.motion_bypass_kitchen_off
      motion_bypass_lights_on: input_boolean.motion_bypass_kitchen_on
      motion_bypass_lights_stop: input_boolean.motion_bypass_kitchen_stop
      light_switch:
        entity_id:
          - light.group_kitchen_lights
      motion_trigger:
        - binary_sensor.kitchen_motion_beta
        - binary_sensor.kitchen_occupancy_beta
      time_delay: 5
- alias: Motion Lights — Hallway Downstairs
  description: ADR-0021 β-sensors; eta-tier group targets
  id: motion_lights_hallway_downstairs
  initial_state: "on"
  max_exceeded: silent
  mode: restart
  use_blueprint:
    path: library/blueprints/sensor-light.yaml
    input:
      include_ambient: ambient_disabled
      include_bypass:
        - bypass_enabled_turn_on
        - bypass_enabled_turn_off
        - bypass_auto_off
      bypass_auto_off_delay: 10
      bypass_time_delay: 0
      motion_bypass_lights_off: input_boolean.motion_bypass_hallway_downstairs_off
      motion_bypass_lights_on: input_boolean.motion_bypass_hallway_downstairs_on
      motion_bypass_lights_stop: input_boolean.motion_bypass_hallway_downstairs_stop
      light_switch:
        entity_id:
          - light.group_hallway_lights_downstairs
      motion_trigger:
        - binary_sensor.hallway_downstairs_motion_beta
        - binary_sensor.hallway_downstairs_occupancy_beta
      time_delay: 3
- alias: Motion Lights — Hallway Upstairs
  description: ADR-0021 β-sensors; eta-tier group targets; includes downstairs recent motion for propagation
  id: motion_lights_hallway_upstairs
  initial_state: "on"
  max_exceeded: silent
  mode: restart
  use_blueprint:
    path: library/blueprints/sensor-light.yaml
    input:
      include_ambient: ambient_disabled
      include_bypass:
        - bypass_enabled_turn_on
        - bypass_enabled_turn_off
        - bypass_auto_off
      bypass_auto_off_delay: 10
      bypass_time_delay: 0
      motion_bypass_lights_off: input_boolean.motion_bypass_hallway_upstairs_off
      motion_bypass_lights_on: input_boolean.motion_bypass_hallway_upstairs_on
      motion_bypass_lights_stop: input_boolean.motion_bypass_hallway_upstairs_stop
      light_switch:
        entity_id:
          - light.group_hallway_lights_upstairs
      motion_trigger:
        - binary_sensor.hallway_upstairs_motion_beta
        - binary_sensor.hallway_downstairs_motion_recent_beta
        - binary_sensor.hallway_upstairs_occupancy_beta
      time_delay: 3

- alias: Linked — Desk Task Lighting Coherence
  description: Link desk group and bedroom utility group for coherent behavior
  id: linked_desk_task_coherence
  initial_state: "on"
  max_exceeded: silent
  mode: restart
  use_blueprint:
    path: library/blueprints/ha-blueprint-linked-entities.yaml
    input:
      delay_miliseconds: 100
      linked_entity:
        - light.group_desk_lights
        - light.group_bedroom_utility_lights

- alias: Motion Lights — Kitchen Add-on (Cooking Mode)
  description: Elevate kitchen lighting during cooking mode
  id: motion_lights_kitchen_addon
  initial_state: "on"
  max_exceeded: silent
  mode: restart
  use_blueprint:
    path: library/blueprints/sensor-light-add-on.yaml
    input:
      light_switch:
        entity_id:
          - light.group_kitchen_lights
      time_delay: 1
      trigger_entities:
        - input_boolean.kitchen_cooking_mode
      trigger_on_state:
        - "on"
      trigger_off_state:
        - "off"

# VAR <-> helper sync and telemetry
automation:
- alias: VAR Sync — Motion Bypass Bedroom ON
  id: var_sync_motion_bypass_bedroom_on
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_bedroom_on
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_bedroom
        value: "true"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_bedroom_off
          - input_boolean.motion_bypass_bedroom_stop
- alias: VAR Sync — Motion Bypass Bedroom OFF
  id: var_sync_motion_bypass_bedroom_off
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_bedroom_off
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_bedroom
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_bedroom_on
          - input_boolean.motion_bypass_bedroom_stop
- alias: VAR Sync — Motion Bypass Bedroom STOP
  id: var_sync_motion_bypass_bedroom_stop
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_bedroom_stop
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_bedroom
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_bedroom_on
          - input_boolean.motion_bypass_bedroom_off
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.motion_bypass_bedroom_stop
- alias: VAR Telemetry — Motion Last Triggered Bedroom
  id: var_telemetry_motion_last_triggered_bedroom
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: light.group_main_bedroom_lights
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_last_triggered_bedroom
        value: "{{ now().isoformat() }}"
- alias: VAR Sync — Motion Bypass Desk ON
  id: var_sync_motion_bypass_desk_on
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_desk_on
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_desk
        value: "true"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_desk_off
          - input_boolean.motion_bypass_desk_stop
- alias: VAR Sync — Motion Bypass Desk OFF
  id: var_sync_motion_bypass_desk_off
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_desk_off
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_desk
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_desk_on
          - input_boolean.motion_bypass_desk_stop
- alias: VAR Sync — Motion Bypass Desk STOP
  id: var_sync_motion_bypass_desk_stop
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_desk_stop
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_desk
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_desk_on
          - input_boolean.motion_bypass_desk_off
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.motion_bypass_desk_stop
- alias: VAR Telemetry — Motion Last Triggered Desk
  id: var_telemetry_motion_last_triggered_desk
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: light.group_desk_lights
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_last_triggered_desk
        value: "{{ now().isoformat() }}"
- alias: VAR Sync — Motion Bypass Ensuite ON
  id: var_sync_motion_bypass_ensuite_on
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_ensuite_on
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_ensuite
        value: "true"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_ensuite_off
          - input_boolean.motion_bypass_ensuite_stop
- alias: VAR Sync — Motion Bypass Ensuite OFF
  id: var_sync_motion_bypass_ensuite_off
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_ensuite_off
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_ensuite
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_ensuite_on
          - input_boolean.motion_bypass_ensuite_stop
- alias: VAR Sync — Motion Bypass Ensuite STOP
  id: var_sync_motion_bypass_ensuite_stop
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_ensuite_stop
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_ensuite
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_ensuite_on
          - input_boolean.motion_bypass_ensuite_off
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.motion_bypass_ensuite_stop
- alias: VAR Telemetry — Motion Last Triggered Ensuite
  id: var_telemetry_motion_last_triggered_ensuite
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: light.group_ensuite_lights
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_last_triggered_ensuite
        value: "{{ now().isoformat() }}"
- alias: VAR Sync — Motion Bypass Kitchen ON
  id: var_sync_motion_bypass_kitchen_on
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_kitchen_on
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_kitchen
        value: "true"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_kitchen_off
          - input_boolean.motion_bypass_kitchen_stop
- alias: VAR Sync — Motion Bypass Kitchen OFF
  id: var_sync_motion_bypass_kitchen_off
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_kitchen_off
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_kitchen
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_kitchen_on
          - input_boolean.motion_bypass_kitchen_stop
- alias: VAR Sync — Motion Bypass Kitchen STOP
  id: var_sync_motion_bypass_kitchen_stop
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_kitchen_stop
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_kitchen
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_kitchen_on
          - input_boolean.motion_bypass_kitchen_off
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.motion_bypass_kitchen_stop
- alias: VAR Telemetry — Motion Last Triggered Kitchen
  id: var_telemetry_motion_last_triggered_kitchen
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: light.group_kitchen_lights
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_last_triggered_kitchen
        value: "{{ now().isoformat() }}"
- alias: VAR Sync — Motion Bypass Hallway Downstairs ON
  id: var_sync_motion_bypass_hallway_downstairs_on
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_hallway_downstairs_on
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_hallway_downstairs
        value: "true"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_hallway_downstairs_off
          - input_boolean.motion_bypass_hallway_downstairs_stop
- alias: VAR Sync — Motion Bypass Hallway Downstairs OFF
  id: var_sync_motion_bypass_hallway_downstairs_off
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_hallway_downstairs_off
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_hallway_downstairs
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_hallway_downstairs_on
          - input_boolean.motion_bypass_hallway_downstairs_stop
- alias: VAR Sync — Motion Bypass Hallway Downstairs STOP
  id: var_sync_motion_bypass_hallway_downstairs_stop
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_hallway_downstairs_stop
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_hallway_downstairs
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_hallway_downstairs_on
          - input_boolean.motion_bypass_hallway_downstairs_off
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.motion_bypass_hallway_downstairs_stop
- alias: VAR Telemetry — Motion Last Triggered Hallway Downstairs
  id: var_telemetry_motion_last_triggered_hallway_downstairs
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: light.group_hallway_lights_downstairs
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_last_triggered_hallway_downstairs
        value: "{{ now().isoformat() }}"
- alias: VAR Sync — Motion Bypass Hallway Upstairs ON
  id: var_sync_motion_bypass_hallway_upstairs_on
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_hallway_upstairs_on
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_hallway_upstairs
        value: "true"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_hallway_upstairs_off
          - input_boolean.motion_bypass_hallway_upstairs_stop
- alias: VAR Sync — Motion Bypass Hallway Upstairs OFF
  id: var_sync_motion_bypass_hallway_upstairs_off
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_hallway_upstairs_off
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_hallway_upstairs
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_hallway_upstairs_on
          - input_boolean.motion_bypass_hallway_upstairs_stop
- alias: VAR Sync — Motion Bypass Hallway Upstairs STOP
  id: var_sync_motion_bypass_hallway_upstairs_stop
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: input_boolean.motion_bypass_hallway_upstairs_stop
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_bypass_hallway_upstairs
        value: "false"
    - service: input_boolean.turn_off
      target:
        entity_id:
          - input_boolean.motion_bypass_hallway_upstairs_on
          - input_boolean.motion_bypass_hallway_upstairs_off
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.motion_bypass_hallway_upstairs_stop
- alias: VAR Telemetry — Motion Last Triggered Hallway Upstairs
  id: var_telemetry_motion_last_triggered_hallway_upstairs
  initial_state: "on"
  mode: single
  trigger:
    - platform: state
      entity_id: light.group_hallway_lights_upstairs
      to: "on"
  action:
    - service: var.set
      data:
        entity_id: var.motion_last_triggered_hallway_upstairs
        value: "{{ now().isoformat() }}"
