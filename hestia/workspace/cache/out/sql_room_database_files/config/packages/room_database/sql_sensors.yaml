sensor:
  - platform: sql
    db_url: sqlite:////config/room_database.db
    scan_interval: 30
    queries:
      - name: "Room Configs — Motion Lighting"
        query: >
          SELECT 'ok' AS state,
                 json_group_object(room_id, config_data) AS payload
          FROM room_configs
          WHERE config_domain = 'motion_lighting';
        column: state
      - name: "Room Configs — Vacuum Control"
        query: >
          SELECT 'ok' AS state,
                 json_group_object(room_id, config_data) AS payload
          FROM room_configs
          WHERE config_domain = 'vacuum_control';
        column: state
      - name: "Rooms Needing Cleaning"
        query: >
          SELECT COALESCE(json_group_array(room_id),'[]') AS payload,
                 json_array_length(COALESCE(json_group_array(room_id),'[]')) AS count
          FROM room_configs
          WHERE config_domain = 'vacuum_control'
            AND json_extract(config_data, '$.needs_cleaning') = 1;
        column: count
