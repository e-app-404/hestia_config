phases:
  - id: P1_DISCOVER
    when: "session start"
    output:
      - "Clarified DSM 7.2 flow (Web Service → Web Portal)"
    status: completed

  - id: P2_STAGING
    output:
      - "User uploaded portal/public HTML and assets"
      - "Manifest + README established acceptance gates"
    status: completed

  - id: P3_CONFIGURE_WS
    output:
      - "Create Web Service xplab-portal → docroot web/portal (screenshot verified)"
      - "Create Web Service xplab-public → docroot web/public"
    status: in_progress

  - id: P4_BIND_PORTAL
    output:
      - "Create Web Portal (name-based) hostname nas.xplab.io → service xplab-public"
    status: pending_user_apply

  - id: P5_REVERSE_PROXY
    output:
      - "/portal → 127.0.0.1:80/portal (DSM auth + Tailscale CIDR allowlist)"
      - "/ha → 192.168.0.129:8123 (strip prefix)"
      - "/grafana → <host>:3000 (strip prefix)"
    status: pending_user_apply

  - id: P6_VALIDATION
    outputs_expected:
      - "public_landing_reachable"
      - "portal_auth_enforced"
      - "tiles_render_from_config"
      - "status_badges_update_within_seconds ≤ 5"
      - "grafana_panel_embeds_successfully"
      - "theme_auto_and_toggle_work"
      - "private_tiles_hidden_on_public"
    source: "/mnt/data/xplab_portal_manifest.yaml"
    status: pending

pending_copilot:
  - "Create xplab-public Web Service"
  - "Create Web Portal binding to nas.xplab.io"
  - "Add three Reverse Proxy rules"
  - "Move files to /volume1/web/{public,portal,_assets}"
