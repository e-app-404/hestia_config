# HESTIA Prompt Registry Validation & Scoring Engine
# Consolidated validation, scoring, and quality assurance framework

registry_validation_engine:
  schema_validation:
    required_fields: [id, file, title, description, type, status, tier, domain, applied_by, derived_from]
    optional_fields: [tags, linked_personas, confidence_score, deviation_flag, evaluations, version, changelog, dependencies, usage_frequency]

    field_patterns:
      id: "^(prompt_\\d{8}_\\d{3}|audit_\\d{8}_\\d{3}|prompt_fallback_[a-z0-9]{6})$"
      tier: "^[αβγδεζημΩ]$"
      status: "^(unreviewed|candidate|approved|deprecated|validated|provisional|rejected|active|proposed)$"
      type: "^(structured|freeform|recursive_structural|validation_trigger|fallback|instructional|operational|extractor|behavioral|emergency_takeover|audit|activation|conversation_reflection|integration_refactor|patch_request_flattening|confidence_guided_extraction|diagnostic|governance_patch|transformation|schema_correction)$"
      confidence_score: "^([0-9]|[1-9][0-9]|100)$"

  confidence_scoring:
    weights:
      metadata_completeness: 40    # All required fields present and valid
      content_quality: 30          # Instruction clarity, structure, examples
      schema_conformance: 20       # Proper YAML format, valid field types
      traceability: 10            # Clear derived_from and dependencies

    scoring_criteria:
      metadata_completeness:
        all_required_present: 40
        missing_1_required: 30
        missing_2_required: 20
        missing_3+_required: 10

      content_quality:
        comprehensive_instruction: 30
        clear_role_behavior: 25
        has_examples: 20
        basic_instruction: 15
        minimal_content: 10

      schema_conformance:
        perfect_yaml: 20
        minor_format_issues: 15
        major_format_issues: 10
        schema_violations: 5

      traceability:
        clear_derivation: 10
        partial_traceability: 7
        minimal_traceability: 5
        no_traceability: 0

    thresholds:
      high_confidence: 85      # Ready for production
      medium_confidence: 70    # Needs minor review
      low_confidence: 50       # Requires major revision
      requires_review: 60      # Flag for human validation
      auto_reject: 30          # Below minimum quality

  batch_validation_pipeline:
    preprocessing:
      - identify_batch_files: "batch\\d+-.*\\.(md|yml|yaml|json)$"
      - extract_metadata: [yaml_frontmatter, content_analysis, filename_heuristics]
      - normalize_fields: [lowercase_tags, dedupe_personas, trim_whitespace]

    validation_sequence:
      1. schema_validation
      2. duplicate_id_detection
      3. confidence_scoring
      4. dependency_verification
      5. tier_domain_alignment_check

    quality_gates:
      - minimum_batch_confidence: 75
      - maximum_deviation_flags: 2
      - zero_schema_violations: required
      - maximum_low_confidence_prompts: 3

  tier_domain_matrix:
    α_tier_domains: [governance, registry_governance, behavior_governance, architecture_alignment, retrieval_control, meta_analysis, knowledge_indexing]
    β_tier_domains: [tooling_analysis, config_tooling, tools_audit, light_entity_generation, file_migration, diagnostic, knowledge_inventory, extraction, operational]
    γ_tier_domains: [instructional, debugging, doc_ingestion]

    domain_definitions:
      governance: "Core system governance, behavioral constraints, and regulatory frameworks"
      extraction: "Data extraction, parsing, and knowledge mining operations"
      operational: "Day-to-day operational procedures and workflows"
      validation: "Quality assurance, compliance checking, and verification processes"
      diagnostic: "System health monitoring, troubleshooting, and anomaly detection"
      tooling_analysis: "Tool ecosystem analysis and architectural planning"
      config_tooling: "Configuration management and YAML processing tools"
      instructional: "Educational content, templates, and guidance documents"

  automated_repairs:
    field_inference:
      missing_tier: "infer_from_domain_and_content"
      missing_domain: "infer_from_instruction_keywords"
      missing_version: "default_to_1.0"
      missing_confidence: "calculate_via_scoring_rubric"

    id_generation:
      fallback_pattern: "prompt_fallback_{6_char_hash}"
      hash_source: "title_description_content"
      collision_resolution: "append_increment_suffix"

  violation_handling:
    critical_violations:
      - invalid_tier_value
      - malformed_id_pattern
      - missing_core_instruction
      - schema_structure_corruption

    auto_fix_violations:
      - whitespace_normalization
      - case_standardization
      - field_type_coercion
      - tag_deduplication

    escalation_triggers:
      - confidence_below_auto_reject
      - multiple_critical_violations
      - dependency_chain_breaks
      - tier_domain_misalignment

validation_reports:
  batch_summary:
    - total_files_processed
    - successful_validations
    - critical_violations_count
    - average_confidence_score
    - tier_distribution
    - domain_coverage

  per_prompt_details:
    - validation_status
    - confidence_breakdown
    - repair_actions_taken
    - violations_detected
    - quality_recommendations