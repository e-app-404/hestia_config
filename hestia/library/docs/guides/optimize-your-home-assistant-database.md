---
title: "Optimize Your Home Assistant Database"
authors:
  - "SHS"
source: "https://smarthomescene.com/"
slug: "optimize-your-home-assistant-database"
tags:
  - home-assistant
  - database
  - mariadb
  - influxdb
  - ops
created: "2022-04-05"
updated: "2025-05-30"
summary:
  intent: "Guide for choosing and configuring Recorder backends (MariaDB/SQLite) and using InfluxDB for long-term time-series storage."
  recommended_recorder_defaults:
    purge_keep_days: 30
    commit_interval: 20
  recommended_storage:
    - "Use MariaDB for medium-term Recorder storage (7-30 days)"
    - "Use InfluxDB for long-term time-series retention and Grafana dashboards"
  key_actions:
    - "Install MariaDB add-on and configure Recorder db_url"
    - "Use InfluxDB alongside Recorder for long-term analytics"
    - "Tune Recorder includes/excludes to reduce write volume"
  warnings:
    - "Do not commit credentials to the repo; use !secret and secrets.yaml"
    - "Purge/repack operations are heavy and should be used sparingly"
url: "https://smarthomescene.com/guides/optimize-your-home-assistant-database/"
---
 
# Optimize Your Home Assistant Database

<!-- TOC: auto-generated by site tooling (or update manually) -->

## Overview

Home Assistant uses a database to store events and parameters for history and tracking of your entities. The default database used in a fresh install is SQLite, which creates a file in your config directory (config/home-assistant_v2.db).

This guide explains how to set up MariaDB as the main SQL recorder database and InfluxDB as a time-series database for long-term data retention, and how to use both simultaneously. It also covers how to fine-tune which entities are recorded.


## Why change and optimize the default database?

You might ask: why change the default database or include/exclude specific entities instead of recording everything? The answer depends on your Home Assistant installation method, the number of devices you have, and how much data you want to retain.

The default SQLite is fine for many users and can be tuned, but for larger installations we recommend using a more robust database such as MariaDB. Both SQLite and MariaDB are relational DBMSs, but MariaDB handles larger datasets better and is faster when displaying history in Home Assistant.

By default Home Assistant keeps data for around 10 days for history and logbook. If you have many devices, HA will write many events to the .db file, which increases storage I/O. This is especially problematic on SD cards (e.g., Raspberry Pi), where heavy write activity can accelerate card failure.

Recommendations to improve reliability and reduce risk:

- Use a backup method such as the Home Assistant Google Drive Backup integration.
- Use an SSD instead of an SD card (via USB-to-SATA adapter on Raspberry Pi); choose compatible drives/adapters.
- If you must use an SD card, pick a High Endurance card designed for many write cycles.

Finally, carefully choose which entities to record. You likely want to record door open events, but you may not need to track Raspberry Pi RAM usage long-term.

## Recorder vs History vs Logbook

Before continuing, clarify the difference between Home Assistant's Recorder, History, and Logbook integrations:

- `Recorder`: stores events, states, and data in the main SQL database (backend storage).
- `History`: displays data from the Recorder in the UI (graphs and charts).
- `Logbook`: shows changes/events as a reverse-chronological list.

### Key takeaways

- If the Recorder is disabled for an entity, History and Logbook will not have the data for that entity.
- If the Recorder is enabled, you can still disable History or Logbook display for an entity in the UI.
- Recorder, History, and Logbook share filter logic (include/exclude); filters are explained below.

Note: InfluxDB is not a replacement for Recorder — it runs alongside Recorder for long-term storage.

## MariaDB vs InfluxDB

MariaDB and InfluxDB serve different purposes:

- `MariaDB`: a relational database (drop-in replacement for MySQL). Use it to replace the default SQLite recorder database for improved performance with larger datasets.
- `InfluxDB`: a time-series database optimized for long-term retention and efficient time-series queries. Use InfluxDB alongside Recorder/MariaDB for long-term analytics and to build Grafana dashboards.

## Installation and setup

### MariaDB

To install MariaDB (Home Assistant OS / Add-ons): Settings > Add-ons > Add-on Store > search for MariaDB > Install. Enable Start on Boot and Watchdog as needed.

Example MariaDB add-on configuration (Configuration tab):

```yaml
databases:
  - homeassistant # Change if you want
logins:
  - username: '!secret mariadb_user'
    password: '!secret mariadb_pass'
rights:
  - username: '!secret mariadb_user'
    database: homeassistant
```

Add secrets to `secrets.yaml` (example):

```yaml
mariadb_user: "<your_mariadb_user>"
mariadb_pass: "<your_mariadb_password>"
mariadb_url: "mysql://<your_mariadb_user>:<your_mariadb_password>@<mariadb_host>/<your_database>?charset=utf8mb4"
```

Enable MariaDB in `configuration.yaml` (Recorder) and tune options as needed. You can use `!include` for cleaner organization:

```yaml
recorder:
  db_url: !secret mariadb_url
  purge_keep_days: 30
  commit_interval: 20
```

### InfluxDB

Install InfluxDB via Settings > Add-ons > Add-on Store > search InfluxDB > Install. Enable Start on Boot and Watchdog; optionally Show in sidebar for easy access to the UI.

After starting the add-on, open its Web UI and create a database from the Admin panel:

- Click + Create Database and provide a name.
- Configure a retention policy (duration or infinite) — InfluxDB is suited for long retention.
- Create a user and grant appropriate permissions.

Enable InfluxDB in `configuration.yaml` (example for InfluxDB 1.x):

```yaml
influxdb:
  host: "<influxdb_host_ip>"
  port: 8086
  database: "<influx_database_name>"
  username: "<influx_username>"
  password: !secret influxdb_pass
  max_retries: 3
  default_measurement: state
```

Note: InfluxDB 2.x uses a different configuration and the Flux query language. If you choose 2.x, follow the official InfluxDB 2.x guide — configuration differs significantly from 1.x.

## Using both MariaDB and InfluxDB

If you enable both MariaDB and InfluxDB, Home Assistant may write the same entities to both databases unless you configure filters. Duplicated data increases backup sizes and storage use.

### Guidance

- Ask yourself: will this data be useful 6–12 months from now? If yes → InfluxDB. If no → MariaDB.
- Some entities may belong in both databases (e.g., a room temperature sensor used in Lovelace and long-term analytics). In that case include it in MariaDB for short-term UI use and InfluxDB for long-term retention.

## Optimizing your databases

Optimizing databases and entity selection can be time-consuming for large installations, but it usually yields significant improvements.

### MariaDB

Use MariaDB for short-term retention (display in Lovelace). Suggested retention: 7–30 days. For longer retention, prefer InfluxDB.

Key Recorder options:

- auto_purge: automatically purge the database (e.g., nightly).
- purge_keep_days: number of days to keep history after purge.
- commit_interval: seconds between commits. Default 1 commits frequently; increasing this reduces disk I/O (good for SD cards) but increases lag in history/logbook. A value of 0 commits as soon as possible.

### InfluxDB

Retention is managed in the InfluxDB UI. Note that InfluxDB 1.x and 2.x have different configuration and APIs — 2.x uses Flux and a different auth/model. Follow the official InfluxDB 2.x guide if using 2.x.

## Optimizing your entities

Before changing recorder filters, export an editable list of entities (e.g., to a spreadsheet): Developer Tools > Templates and paste:

```jinja
{% for state in states %}
  - {{ state.entity_id -}}
{% endfor %}
```

Recorder and InfluxDB filters share similar syntax. Options:

- No includes/excludes: record all entities.
- Includes only: record only included entities (exclude everything else).
- Excludes only: record everything except excluded entities.
- Includes and excludes: combination for finer control.

Filter types:

- domains: include/exclude entire domains (e.g., light).
- entity_globs: include/exclude pattern-matching entity IDs (e.g., sensor.weather_*).
- entities: include/exclude specific entities (e.g., sensor.disk_free).

### Example 1 — Recorder (includes only)

```yaml
recorder:
  db_url: !secret mariadb_url
  purge_keep_days: 30
  commit_interval: 20
  include:
    domains:
      - light
    entity_globs:
      - sensor.weather_*
    entities:
      - sensor.disk_free
      - sensor.disk_use
      - sensor.disk_use_percent
```

### Example 2 — Recorder (excludes only)

```yaml
recorder:
  db_url: !secret mariadb_url
  purge_keep_days: 30
  commit_interval: 20
  exclude:
    domains:
      - automation
    entity_globs:
      - binary_sensor.*_occupancy
    entities:
      - switch.living_room_light
      - light.bathroom_light
      - sensor.processor_temperature
```

### Example 3 — Recorder (includes and excludes)

```yaml
recorder:
  db_url: !secret mariadb_url
  purge_keep_days: 30
  commit_interval: 20
  include:
    domains:
      - light
  exclude:
    entities:
      - light.living_room_light
```

This configuration records all entities from the `light` domain except `light.living_room_light`.

### Example 4 — InfluxDB filters (similar syntax)

```yaml
influxdb:
  host: 192.168.0.xxx
  port: 8086
  database: homeassistant
  username: homeassistant
  password: !secret influxdb_pass
  max_retries: 3
  default_measurement: state
  include:
    domains:
      - light
  exclude:
    entities:
      - light.living_room_light
```
### Example 5 — History example

```yaml
history:
  exclude:
    domains:
      - automation
      - updater
    entities:
      - sensor.last_boot
      - sensor.date
    entity_globs:
      - binary_sensor.*_occupancy
```

### Example 6 — Logbook example

```yaml
logbook:
  include:
    domains:
      - alarm_control_panel
      - light
    entity_globs:
      - binary_sensor.*_occupancy
  exclude:
    entities:
      - light.kitchen_light
```
## Purging the database

To purge MariaDB via Home Assistant services (Developer Tools > Services):

Purge a single entity:

```yaml
service: recorder.purge_entities
target:
  entity_id: alarm_control_panel.apartment
```

Purge entities by domain:

```yaml
service: recorder.purge_entities
data:
  domains: light
```

Purge the entire database (repack):

```yaml
service: recorder.purge
data:
  repack: true
```

Warning: purging and repacking the entire database is heavy — it rebuilds events and states tables. Use only for significant slowdowns or maintenance.

To purge InfluxDB, use the InfluxDB UI or execute a query in the Explore/CLI panel (example for InfluxDB 1.x):

```sql
USE "homeassistant"; DELETE WHERE time < '2022-04-04'

-- Purge a single entity
USE "homeassistant"; DELETE WHERE "entity_id" = 'sensor.bathroom_temperature' AND time < '2022-04-04'
```
## Tracking database size

You can create sensors to monitor database sizes. Example — InfluxDB database size sensor:

```yaml
sensor:
  - platform: influxdb
    host: "<influxdb_host_ip>"
    port: 8086
    username: "<influx_username>"
    password: !secret influxdb_pass
    scan_interval: 3600
    queries:
      - name: InfluxDB Database Size
        unit_of_measurement: MB
        value_template: "{{ (value | float(0) / 1024 / 1024) | round(1) }}"
        group_function: sum
        measurement: '"monitor"."shard"'
        database: _internal
        where: '"database"=''<influx_database_name>'' AND time > now() - 5m'
        field: diskBytes
```

For MariaDB (recorder), use the SQL integration (Settings > Devices & Services > Add Integration > SQL). Provide the query and mapping details. The Database URL can often be left blank if MariaDB is set as the default recorder database.

## Security note

- Do not commit real passwords, keys, or secrets to this repository.
- Use `secrets.yaml` and `!secret` in `configuration.yaml` to keep credentials out of version control.
- Replace example credential values with placeholders before committing.

## Validation / CI

Run the repository's YAML/Markdown validators before committing (example):

```bash
# example: run repo lint/validator (adjust path as needed)
python3 hestia/tools/validators/yaml_lint.py
```

If your repo uses a static site generator, run the site build to check rendering.

## Summary

Optimizing your Home Assistant database can be time-consuming for large installs, but it improves performance and reliability. Use domain-based includes and excludes where possible and avoid recording high-frequency system metrics unless you need them long-term.

### Entities you probably don't need to record

- System monitor: RAM, CPU, network, and disk usage
- Mobile device details: battery level, public IP, internal storage
- Battery percentage sensors (per-device)
- Battery low binary sensors
- Zones
- Most scripts
- Some automations

## Full example `configuration.yaml` (combined)

```yaml
# configuration.yaml
default_config:

# Recorder (MariaDB)
recorder:
  db_url: "mysql://<your_mariadb_user>:<your_mariadb_password>@<mariadb_host>/<your_database>?charset=utf8mb4"
  purge_keep_days: 30
  commit_interval: 20

# InfluxDB (example)
influxdb:
  host: "<influxdb_host_ip>" # Internal IP of InfluxDB
  port: 8086
  database: "<influx_database_name>"
  username: "<influx_username>"
  password: "<influx_password>"
  max_retries: 3
  default_measurement: state
```

Example sensor for database file size (InfluxDB):

```yaml
sensor:
  - platform: influxdb
    host: 192.168.0.xxx
    port: 8086
    username: username
    password: password
    scan_interval: 3600
    queries:
      - name: InfluxDB Database Size
        unit_of_measurement: MB
        value_template: "{{ (value | float(0) / 1024 / 1024) | round(1) }}"
        group_function: sum
        measurement: '"monitor"."shard"'
        database: _internal
        where: '"database"=''smarthomescene'' AND time > now() - 5m'
        field: diskBytes
```