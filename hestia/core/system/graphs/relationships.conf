# relationships.conf — system graph (device → service → port, hostname ↔ IP)
relationships:
	graph:
		- device: rpi5
			roles: [home_assistant_host]
			runs:
				- component: home_assistant_core
				- component: home_assistant_supervisor
			network:
				lan_ipv4: 192.168.0.1
				tailscale_ipv4: 100.105.130.99
				dns:
					- homeassistant
					- homeassistant.reverse-beta.ts.net
			exposes:
				- service: http_ui
					protocol: http
					port: 8123
					bindings:
						- 192.168.0.1:8123
						- 0.0.0.0:8123   # desired for remote via Tailscale
				- service: smb_share
					protocol: smb
					ports: [445, 139]
					bindings:
						- 0.0.0.0:445
		- device: synology_ds220plus
			roles: [nas]
			exposes:
				- service: smb_share
					protocol: smb
					ports: [445, 139]

	overlays:
		tailscale:
			features: [magicdns, overlay_ip]
			peers:
				- from: client_belgium
					to:
						- rpi5
						- synology_ds220plus
			name_resolution:
				- fqdn: homeassistant.reverse-beta.ts.net
					maps_to: 100.105.130.99
			notes: "SMB works transparently (445); HTTP UI needs :8123 or reverse proxy."