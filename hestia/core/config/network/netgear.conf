---
as_built:
  name: "Netgear GS724T v3 — VLAN Segmentation (interim, no router trunk)"
  change_date: "2025-09-14"

  device:
    vendor: "Netgear"
    model: "GS724Tv3"
    firmware: "5.4.2.10"
    platform_packages: ["FASTPATH QOS"]
    mgmt_ip: "192.168.0.254"
    mgmt_vlan: 1
    ui_access: "http://192.168.0.254"

  network:
    ip: "192.168.0.254"
    subnet_mask: "255.255.255.0"
    gateway: "192.168.0.1"
    dns_servers: ["192.168.0.1", "8.8.8.8", "1.1.1.1"]

  time_sync:
    sntp:
      mode: "unicast"
      servers:
        - "192.168.0.1"
        - "129.6.15.28"
        - "216.239.35.4"

  snmp:
    communities:
      - name: "ha_snmp"
        access: "ro"
        manager_ip: "192.168.0.129/32"

  stp:
    name: "20-E5-2A-68-55-78"

  design:
    mode: "layer2_isolation_only"
    rationale: "Router (TP-Link AX53) lacks LAN 802.1Q subinterfaces/DHCP; keep management on VLAN 1."

  vlans:
    - id: 1
      name: "Default"
      membership:
        untagged_ports: [1, 2, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]
        tagged_ports: []
    - id: 10
      name: "IoT"
      membership:
        untagged_ports: [3, 4, 5, 6, 7, 8]
        tagged_ports: []
    - id: 20
      name: "Guest"
      membership:
        untagged_ports: [9, 10, 11, 12]
        tagged_ports: []

  pvid_map:
    1: 1
    2: 1
    3: 10
    4: 10
    5: 10
    6: 10
    7: 10
    8: 10
    9: 20
    10: 20
    11: 20
    12: 20
    13: 1
    14: 1
    15: 1
    16: 1
    17: 1
    18: 1
    19: 1
    20: 1
    21: 1
    22: 1
    23: 1
    24: 1

  ports:
    defaults:
      acceptable_frame_types: "Admit All"
      ingress_filtering: "Disable"
    descriptions:
      1: "TRUNK_to_Router (native1)"
      13: "DSM 220plus NAS"
      14: "Home Assistant RPI5"
      16: "Aeotec Hub"
      20: "PS4"
      22: "Apple TV"
      23: "SONOS Ray"
      24: "MacBook dock"

  lag:
    enabled: false
    notes:
      - "All LAGs 1–8 present with link-status traps disabled; no active member ports configured."

  management:
    persisted_to_startup: true
    backup_exported: true

  ha_integration:
    snmp:
      version: "2c"
      community: "ha_snmp"
      manager: "192.168.0.129"
    group_entity: "group.netgear_gs724t"

  validation:
    performed:
      - name: "VLAN10 isolation"
        method: "plug_test"
        port: 5
        expected: ["no DHCP from 192.168.0.0/24", "no LAN access"]
        status: "pass_expected"
      - name: "VLAN20 isolation"
        method: "plug_test"
        port: 10
        expected: ["no DHCP from 192.168.0.0/24", "no LAN access"]
        status: "pass_expected"
      - name: "LAN reachability"
        method: "ping from VLAN1"
        from_port: 24
        targets: ["192.168.0.254", "192.168.0.1"]
        status: "pass_expected"

  notes:
    - "Port 1 intentionally NOT a member of VLANs 10/20 (router cannot trunk)."
    - "Interface-level entries in the text config show PVID and participation for access ports (3–12), aligned with UI state."
    - "Upgrade path: add VLAN-capable router/firewall to enable trunk on g1 (1U,10T,20T) and DHCP per VLAN."

---
extracted_config:
  device: netgear_gs724t_v3
  role: managed_switch
  mgmt_ip: 192.168.0.254
  mac: 20:E5:2A:68:55:78
  subnet_mask: 255.255.255.0
  default_gateway: 192.168.0.1
  dns_servers:
    - 192.168.0.1     # Router (TP-Link AX53)
    - 8.8.8.8         # Google
    - 1.1.1.1         # Cloudflare
  ntp_servers:
    - 192.168.0.1     # Router forwards
    - 129.6.15.28     # NIST
    - 216.239.35.4    # Google Public NTP
  snmp:
    version: 2c
    community_strings:
      - public (RO)
    management_station: 192.168.0.129   # HA host
  vlan_config: default_only   # no VLANs defined yet
  lacp: disabled              # no link aggregation yet
  ui_access:
    web_ui: http://192.168.0.254
    credentials: 
      user: admin
      pass: (changed from default)
  save_config_required: true

transient_state:
  switch_status: online
  last_seen: "now"
  dhcp_status: disabled (moved to static IP)
  dns_resolution: expected_ok
  ntp_sync: pending (after server entries saved)
  snmp_poll: not yet tested

relationships:
  - source: netgear_gs724t_v3
    target: tp_link_ax53_router
    relation: default_gateway + dns_forwarder
  - source: netgear_gs724t_v3
    target: homeassistant
    relation: snmp_management_station
  - source: tp_link_ax53_router
    target: zyxel_nr5103e_modem
    relation: wan_passthrough
  - source: homeassistant
    target: netgear_gs724t_v3
    relation: planned_snmp_sensor_config

suggested_commands:
  # Verify SNMP from HA host
  - snmpwalk -v2c -c public 192.168.0.254 1.3.6.1.2.1.1.1.0

  # Check ifIndex mapping (for HA sensors)
  - snmpwalk -v2c -c public 192.168.0.254 1.3.6.1.2.1.31.1.1.1.1

  # Confirm NTP sync
  - ntpq -p 192.168.0.254

  # Backup switch config
  - curl -u admin:<password> http://192.168.0.254/backup.cfg -o gs724t_backup.cfg

notes:
  - Switch was initially discovered at 192.168.0.49 via DHCP.
  - Static IP assigned at 192.168.0.254 to avoid conflicts (outside DHCP range 192.168.0.2–.253).
  - SNTP config entered manually: Router as primary, fallback to NIST & Google.
  - DNS set to router → ensures consistency with Tailscale MagicDNS (100.100.100.100) and Cloudflare.
  - SNMP community "public" enabled for HA/Glances polling (RO only).
  - VLANs, LACP, and QoS not yet configured — optional next steps.
  - Reminder: Netgear web UI requires “Save Configuration” or changes will revert after reboot.


# Home Assistant entities

group:
  netgear_gs724t:
    name: "Netgear GS724T"
    icon: mdi:ethernet
    entities:
      - binary_sensor.gs724t_port1_link
      - binary_sensor.gs724t_port2_link
      - sensor.gs724t_sys_name
      - sensor.gs724t_sys_uptime_seconds
      - sensor.gs724t_if_count
      - sensor.gs724t_ifname_1
      - sensor.gs724t_ifname_2
      - sensor.gs724t_port1_oper_status_raw
      - sensor.gs724t_port2_oper_status_raw
      - sensor.gs724t_port1_in_octets
      - sensor.gs724t_port1_out_octets
      - sensor.gs724t_port1_in_Bps
      - sensor.gs724t_port1_out_Bps
      - sensor.gs724t_port_1_in_bps
      - sensor.gs724t_port_1_out_bps
