#!/bin/sh
# Deny committing Home Assistant runtime state
git diff --cached --name-only -z | tr '\0' '\n' | grep -E '^\.storage/' >/dev/null 2>&1
if [ $? -eq 0 ]; then
  echo >&2 "ERROR: .storage/ contents are runtime state and must not be committed (ADR-0018)."
  echo >&2 "Unstage with: git restore --staged .storage && retry."
  exit 1
fi
exit 0