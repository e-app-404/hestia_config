# ───────────────────────────────────────────────────────────────────────────────
# ▶ Ensuite Shower Occupancy Composite (domain/binary_sensors/ensuite_shower_trend.yaml)
# Role: high-level composite signal for shower-related presence
# ───────────────────────────────────────────────────────────────────────────────

- binary_sensor:
    - name: "Ensuite Shower Occupancy (Epsilon)"
      unique_id: ensuite_shower_occupancy_epsilon
      device_class: occupancy
      state: >
        {% set detected = is_state('binary_sensor.ensuite_shower_detected', 'on') %}
        {% set recent = is_state('binary_sensor.ensuite_shower_recent', 'on') %}
        {% set ended = is_state('binary_sensor.ensuite_shower_end_detected', 'on') %}
        {{ (detected or recent) and not ended }}
      attributes:
        tier: "ε"
        canonical_id: "ensuite_shower_occupancy_ε"
        file: "/config/domain/templates/humidity_logic.yaml"
        subsystem: "hermes"
        module: "room_occupancy"
        role: "logic"
        type: "inference"
        composite_logic: "recent OR detected AND NOT end"
        upstream_sources: >
          {{ ['binary_sensor.ensuite_shower_detected', 'binary_sensor.ensuite_shower_recent', 'binary_sensor.ensuite_shower_end_detected'] | tojson }}
        floor: "sanctum"
        area_id: "ensuite"