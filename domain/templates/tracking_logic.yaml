# ════════════════════════════════════════════════════════════════════════════════
# ▶ TRACKING LOGIC: Presence via Device Trackers ◀
# ⟫⟫ Logic-based presence status for individual and grouped entities
# ⟫⟫ Domain: template • Loader: !include_dir_merge_list domain/template/
# ⟫⟫ Schema: sensor (list) • Created: 2025-07-17
# ════════════════════════════════════════════════════════════════════════════════
# Future-Ready Notes:
# - The tracked_entities list can be expanded to include tuples like (entity, weight) or (entity, confidence).
# - Later enhancements could add logic for zone filtering, last_seen logic, or entity device_class.
# - Wrapping the logic in a macro or a Python script is viable for dynamic or weighted states.
  
- sensor:
    - name: "Any Home Presence"
      unique_id: any_home_presence
      state: >
        {% set tracked_entities = [
          'device_tracker.macbook',
          'device_tracker.everts_apple_watch',
          'device_tracker.iphone11',
          'device_tracker.iphone14',
          'device_tracker.ephone_uk',
          'device_tracker.nintendo_switch',
          'device_tracker.wallet',
          'device_tracker.keys',
          'device_tracker.backpack',
          'device_tracker.ephone',
          'device_tracker.iphone8'
        ] %}
        {% set present = tracked_entities
            | select('defined')
            | select('is_state', 'home')
            | list %}
        {% if present | length > 0 %}
          Home
        {% else %}
          Away
        {% endif %}
      attributes:
        file: "/config/domain/templates/tracking_logic.yaml"
        source_count: "1"

    - name: "Macbook Presence"
      unique_id: macbook_presence
      state: "{{ 'Home' if is_state('device_tracker.macbook', 'home') else 'Away' }}"

    - name: "Apple_Watch Presence"
      unique_id: apple_watch_presence
      state: "{{ 'Home' if is_state('device_tracker.everts_apple_watch', 'home') else 'Away' }}"

    - name: "iPhone11 Presence"
      unique_id: iphone11_presence
      state: "{{ 'Home' if is_state('device_tracker.iphone11', 'home') else 'Away' }}"

    - name: "iPhone14 Presence"
      unique_id: iphone14_presence
      state: "{{ 'Home' if is_state('device_tracker.iphone14', 'home') else 'Away' }}"

    - name: "ePhone-Uk Presence"
      unique_id: ephone_uk_presence
      state: "{{ 'Home' if is_state('device_tracker.ephone_uk', 'home') else 'Away' }}"

    - name: "Nintendo_Switch Presence"
      unique_id: nintendo_switch_presence
      state: "{{ 'Home' if is_state('device_tracker.nintendo_switch', 'home') else 'Away' }}"

    - name: "Wallet Presence"
      unique_id: wallet_presence
      state: "{{ 'Home' if is_state('device_tracker.wallet', 'home') else 'Away' }}"

    - name: "Keys Presence"
      unique_id: keys_presence
      state: "{{ 'Home' if is_state('device_tracker.keys', 'home') else 'Away' }}"

    - name: "Backpack Presence"
      unique_id: backpack_presence
      state: "{{ 'Home' if is_state('device_tracker.backpack', 'home') else 'Away' }}"

    - name: "ePhone Presence"
      unique_id: ephone_presence
      state: "{{ 'Home' if is_state('device_tracker.ephone', 'home') else 'Away' }}"

    - name: "iPhone8 Presence"
      unique_id: iphone8_presence
      state: "{{ 'Home' if is_state('device_tracker.iphone8', 'home') else 'Away' }}"
