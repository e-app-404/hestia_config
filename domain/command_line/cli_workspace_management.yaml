#═══════════════════════════════════════════════════════════════
# ▶ SENSOR: Hestia Workspace Management ◀
# Loader: !include_dir_merge_list domain/command_line
# Schema: command_line
# Purpose: Monitor HestiaOS workspace usage (trash size, old temp files)
#═══════════════════════════════════════════════════════════════


- sensor:
    name: "Hestia Trash Size"
    command: >-
      sh -lc '
        du -s /config/.trash 2>/dev/null | awk "{print \$1}" || echo "0"
      '
    unit_of_measurement: "KiB"
    device_class: data_size
    state_class: measurement
    scan_interval: 3600
    unique_id: hestia_trash_size
    icon: mdi:trash-can
    value_template: "{{ value | default('0') | trim | int(0) }}"

- sensor:
    name: "Hestia Tmp Old Files"
    command: >-
      sh -lc '
        find /config/tmp -type f -mtime +7 2>/dev/null | wc -l | tr -d " " || echo "0"
      '
    unit_of_measurement: "files"
    state_class: measurement
    scan_interval: 3600
    unique_id: hestia_tmp_old_files
    icon: mdi:file-clock
    value_template: "{{ value | default('0') | trim }}"

- sensor:
    name: "Hestia Workspace Size"
    command: >-
      sh -lc '
        cd /config && du -sh . 2>/dev/null | awk '\''{print $1}'\'' || echo "Unknown"
      '
    scan_interval: 7200
    unique_id: hestia_workspace_total_size
    icon: mdi:folder-multiple
    value_template: "{{ value | default('Unknown') | trim }}"

- sensor:
    name: "Hestia Git Status"
    command: >-
      sh -lc '
        cd /config && git status --porcelain 2>/dev/null | wc -l | tr -d " " || echo "-1"
      '
    scan_interval: 1800
    unique_id: hestia_git_uncommitted_changes
    icon: mdi:git
    value_template: >-
      {% set val = value | default('-1') | trim | int(-1) %}
      {% if val == -1 %}
        unavailable
      {% elif val == 0 %}
        clean
      {% else %}
        {{ val }}
      {% endif %}